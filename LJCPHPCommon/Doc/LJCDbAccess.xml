<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright (c) Lester J. Clark 2022 - All Rights Reserved -->
<!-- LJCDbAccess.xml -->  
<items>
  <!-- The XML file for the first file class contains the library comments. -->
  <LJCHTMLLib>
    <summary>
      The SQL Data Access Library
    </summary>
    <remarks>
      Use this code to include the Collection lib classes.
      &lt;pre&gt;
      declare(strict_types=1);
      include_once "LJCRoot.php";
      $prefix = RelativePrefix();
      include_once "$prefix/LJCPHPCommon/LJCDBAccessLib.php";&lt;/pre&gt;
    </remarks>
  </LJCHTMLLib>
  <LJCDbAccess>
		<summary>
      Provides standard PDO Data Access.
    </summary>
		<remarks>
			The Data Access class encapsulates the repetitive code required to
			perform common database functions using PDO. This reduces the amount of
			application code required to access this functionality and provides a
			standard location for implementing common best practices.
		</remarks>
	</LJCDbAccess>
	
	<!-- Static Functions -->
	<GetValue>
		<summary>
			Returns a data value if the element exists.</summary>
		<param name="$row">The data row columns.</param>
		<param name="$columnName">The column name.</param>
		<returns>The data value if the element exists; otherwise null.</returns>
		<code>
      // Returns a data value if the element exists.
      private static function GetValue(LJCConnectionValues $connectionValues)
      {
        // See constructor for how to create $connectionValues.
        $dbAccess = new LJCDbAccess($connectionValues);

        $tableName = "TableName";
        $sql = "select ID, Name from {$tableName} where ID = 1";
        $row = $dbAccess->Retrieve($sql);
        $id = LJCDbAccess::GetValue($row, "ID");
        $name = LJCDbAccess::GetValue($row, "Name");
        $result = "{$id}, {$name}";

        // result:
        // 1, Name
      }
    </code>
	</GetValue>

	<!-- Constructors -->
	<construct>
		<summary>
      Initializes a class instance.
    </summary>
		<param name="$connectionValues">The Connection values.</param>
		<code>
      // Initializes a class instance.
      private static function construct(): LJCConnectionValues
      {
        $dbServer = "localhost";
		    $dbName = "DatabaseName";
		    $userID = "UserID";
		    $password = "Password";
		    $retValues = new LJCConnectionValues($dbServer, $dbName, $userID
			    , $password);
        if (null == $retValues
          || $retValues->DbServer != "localhost"
          || $retValues->DbName != "DatabaseName"
          || $retValues->UserID != "UserID"
          || $retValues->Password != "Password")
        {
          echo("\r\nSetConnectionValues() Connection values not set correctly.");
        }
        return $retValues;
      }
    </code>
	</construct>

	<!-- Public Data Methods -->
	<Execute>
		<summary>Executes a non-query sql statement.</summary>
		<param name="$sql">The SQL statement.</param>
		<returns>The count of affected records.</returns>
		<code>
      // Executes a non-query sql statement.
      public function Execute(LJCConnectionValues $connectionValues): int
      {
		    // See constructor for how to create $connectionValues.
		    $dbAccess = new LJCDbAccess($connectionValues);

		    $tableName = "TableName";

        // Insert test record.
        $name = "Test";
        $sql = "insert into {$tableName}\r\n ";
        $sql .= "(Name)\r\n ";
        $sql .= "values('{$name}');";
		    $affectedCount = $dbAccess->Execute($sql);
        if (0 == $affectedCount)
        {
          echo("\r\nExecute() No record inserted.");
        }

        // Retrieve assigned ID.
        $sql = "select\r\n ";
        $sql .= "ID, Name\r\n ";
        $sql .= "from {$tableName}\r\n ";
        $sql .= "where Name = '{$name}';";
        $row = $dbAccess->Retrieve($sql);
        if ($row == null)
        {
          echo("\r\nExecute() select row not found");
        }
        $id = LJCDbAccess::GetValue($row, "ID");
        if ($id == null)
        {
          echo("\r\nExecute() ID not found");
        }

        // Delete test record.
        if ($id != null)
        {
		      $sql = "delete from {$tableName}\r\n ";
          $sql .= "where ID = {$id};";
		      $affectedCount = $dbAccess->Execute($sql);
          if (0 == $affectedCount)
          {
            echo("\r\nExecute() No record found to delete.");
          }
        }
      }
    </code>
	</Execute>
	<Load>
		<summary>Loads the records for the provided SQL statement.</summary>
		<param name="$sql">The SQL statement.</param>
		<returns>An array of data records.</returns>
		<code>
      // Loads the records for the provided SQL statement.
      private static function Load(LJCConnectionValues $connectionValues)
      {
		    // See constructor for how to create $connectionValues.
		    $dbAccess = new LJCDbAccess($connectionValues);

		    $tableName = "TableName";
        $sql = "select * from {$tableName};";
        $rows = $dbAccess->Load($sql);
        if (null == $rows
          || (is_array($rows)
          &amp;&amp; count($rows) == 0))
        {
          echo("\r\nLoad() rows not found");
        }
      }
		</code>
	</Load>
	<Retrieve>
		<summary>Retrieves a record for the provided SQL statement.</summary>
		<param name="$sql">The SQL statement.</param>
		<returns>An array of record columns.</returns>
		<code>
      // Retrieves a record for the provided SQL statement.
      private static function Retrieve(LJCConnectionValues $connectionValues)
      {
		    // See constructor for how to create $connectionValues.
		    $dbAccess = new LJCDbAccess($connectionValues);
		    $tableName = "TableName";

        // Insert test record.
        $name = "Test";
        $sql = "insert into {$tableName}\r\n ";
        $sql .= "(Name)\r\n ";
        $sql .= "values('{$name}');";
		    $affectedCount = $dbAccess->Execute($sql);
        if (0 == $affectedCount)
        {
          echo("\r\nRetrieve() No record inserted.");
        }

        // Retrieve assigned ID.
        $sql = "select\r\n ";
        $sql .= "ID, Name\r\n ";
        $sql .= "from {$tableName}\r\n ";
        $sql .= "where Name = '{$name}';";
        $row = $dbAccess->Retrieve($sql);
        if ($row == null)
        {
          echo("\r\nRetrieve() select row not found");
        }
        $id = LJCDbAccess::GetValue($row, "ID");
        if ($id == null)
        {
          echo("\r\nRetrieve() ID not found");
        }

        // Delete test record.
        if ($id != null)
        {
		      $sql = "delete from {$tableName}\r\n ";
          $sql .= "where ID = {$id};";
		      $affectedCount = $dbAccess->Execute($sql);
          if (0 == $affectedCount)
          {
            echo("\r\nRetrieve() No record found to delete.");
          }
        }
      }
		</code>
	</Retrieve>

	<!-- Other Public Methods -->
	<GetConnection>
		<summary>Creates the PDO connection.</summary>
		<returns>The PDO connection object.</returns>
		<code>
      // Retrieves a record for the provided SQL statement.
      private static function GetConnection(LJCConnectionValues $connectionValues)
      {
		    // See constructor for how to create $connectionValues.
		    $dbAccess = new LJCDbAccess($connectionValues);

        $connection = $dbAccess->GetConnection();
        if (null == $connection)
        {
          echo("\r\nGetConnection() The Connection was not created.");
        }
      }
		</code>
	</GetConnection>
	<LoadTableSchema>
		<summary>Returns the Table Schema DbColumns collection.</summary>
		<param name="$dbName">The Database name.</param>
		<param name="$tableName">The Table name.</param>
		<returns>A DbColumns collection of column definitions.</returns>
		<code>
      // Returns the Table Schema DbColumns collection.
      private static function LoadTableSchema(
          LJCConnectionValues $connectionValues)
      {
		    // See constructor for how to create $connectionValues.
		    $dbAccess = new LJCDbAccess($connectionValues);

		    $dbName = "DatabaseName";
		    $tableName = "TableName";
        $schema = $dbAccess->LoadTableSchema($dbName, $tableName);
        if (null == $schema
          || !$schema instanceof LJCDataColumns
          || count($schema) == 0)
        {
          echo("\r\nLoadTableSchema() The Schema was not retrieved.");
        }
      }
		</code>
	</LoadTableSchema>
	<SetConnectionValues>
		<summary>Sets the $ConnectionValues property.</summary>
		<param name="$dbServer">The DB Server name.</param>
		<param name="$dbName">The Database name.</param>
		<param name="$userID">The user name.</param>
		<param name="$password">The user Password.</param>
		<code>
      // Resets the $ConnectionValues property.
      private static function SetConnectionValues(
        LJCConnectionValues $connectionValues)
      {
		    // See constructor for how to create $connectionValues.
		    $dbAccess = new LJCDbAccess($connectionValues);

        $dbServer = "localhost";
		    $dbName = "DatabaseName";
		    $userID = "UserID";
		    $password = "Password";
        $dbAccess->SetConnectionValues($dbServer, $dbName, $userID, $password);
        $values = $dbAccess->ConnectionValues;
        if (null == $values
          || $values->DbServer != "localhost"
          || $values->DbName != "DatabaseName"
          || $values->UserID != "UserID"
          || $values->Password != "Password")
        {
          echo("\r\nSetConnectionValues() Connection values not set correctly.");
        }
      }
		</code>
	</SetConnectionValues>

	<!-- Private Methods -->
	<GetTableSchema>
		<summary>Creates the Table Schema DbColumn object.</summary>
		<param name="$row">The array of data columns.</param>
		<returns>A DbColumn table column definition.</returns>
	</GetTableSchema>
</items>